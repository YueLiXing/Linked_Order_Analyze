# Linked_Order_Analyze
App启动时间优化 二进制重排技术 线下量化预分析工具

目的：在没有上线之前可以分析出对App启动优化节省的大致时间，起到指导作用。(_具体能优化多少，以线上数据为准_)

---

请先阅读并读懂理解各个技术点：[iOS 优化篇 - 启动优化之Clang插桩实现二进制重排](http://www.zyiz.net/tech/detail-127196.html)

---

大体思路：
```
 1. 读取 Linked Map 文件，获取 __Text 代码区的起始地址和块大小，分析得到需要分配的虚拟内存页个数
 2. 获取 __Text 代码区 所有symbol的地址、大小和具体符号，存入字典
 3. 根据字典中的起始地址和所有symbol大小的总和，校验是否和1描述相符 (_发现有重复 symbol 和 symbol地址跳跃现象_)
 4. 分析 二进制重排文件order所包含的symbol，和2中字典做映射，得到symbol对应的地址和内存占用大小
 5. 分析 order文件中所包含的symbol，得到需要占用的原始虚拟内存页个数
 6. 将 order文件中所包含的symbol内存占用大小相加，分析得到 重排后所占虚拟内存页个数
 7. 原始虚拟内存页个数 - 重排后所占虚拟内存页个数 = 节省的虚拟内存页个数
 8. 节省的虚拟内存页个数 * 每一个内存缺页中断大致的处理时间 = 节省的内存缺页中断处理总时间
 ```

---

使用之前：
1. 使用xcode编译出 linked map.txt 和 lib.order 文件，并放在同一个目录
2. 修改下面的路径到上述两个文件的根目录
```
// 链接文件和order文件根目录
static NSString * const BASE_PATH = @"/Users/liyang/Desktop/1"; 
```

---

最终输出示例：
```
---> 分析结果：
 lined map __Text(链接文件)：
   起始地址：0x100006A60
   结束地址：0x1021E75E8
   分配的虚拟内存页个数：2169
 order symbol(重排文件)：
   需要重排的符号个数：4630
   分布的虚拟内存页个数：392
   二进制重排后分布的虚拟内存页个数：99
   内存缺页中断减少的个数：293
   预估节省的时间：146ms
   ```

---
